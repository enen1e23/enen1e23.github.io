<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>è¥¿å®‰å¸‚å¤æ ‘åæœ¨äº’åŠ¨åœ°å›¾</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f6f4f1;
    }
    .layout {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 340px;
      padding: 16px 18px;
      background: #f9f6f1;
      border-right: 1px solid #e0d6c8;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
    }
    .sidebar h1 {
      font-size: 20px;
      margin: 0 0 6px;
      font-weight: 600;
      color: #5a3d32;
    }
    .sidebar h2 {
      font-size: 14px;
      margin: 12px 0 4px;
      font-weight: 600;
      color: #5a3d32;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .sidebar p {
      margin: 0;
      font-size: 12px;
      color: #666;
      line-height: 1.6;
    }
    .chart-card {
      background: #fff;
      border-radius: 8px;
      padding: 8px 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      border: 1px solid #e5ddd2;
      max-width: 350px;
      max-height: 300px;
      overflow: hidden;
      margin: 0 auto;
    }
    #map {
      flex: 1;
      height: 100vh;
    }
    #speciesChart {
      height: 160px;
      width: 300px;
    }
  </style>
  <script>
    // æ•°æ®ç¤ºä¾‹ï¼ˆXA_GUSHUï¼‰
    var XA_GUSHU = [
      {"id": "61011500097", "name": "å›½æ§", "age": "600", "address": "è¥¿å®‰å¸‚ä¸´æ½¼åŒºç§¦æ–‡åŒ–å®«ç®¡å§”ä¼š", "lng": 109.214249, "lat": 34.367181},
      {"id": "610104107001", "name": "ä¾§æŸ", "age": "363", "address": "è¥¿å®‰å¸‚è²æ¹–åŒºé’å¹´è·¯è¡—é“è¥¿åŒ—ä¸€è·¯ç¤¾åŒº", "lng": 108.926324, "lat": 34.26858},
      {"id": "610104168001", "name": "ç´«ä¸é¦™", "age": "138", "address": "è¥¿å®‰å¸‚è²æ¹–åŒºé’å¹´è·¯è¡—é“è¥¿åŒ—ä¸€è·¯ç¤¾åŒº", "lng": 108.926324, "lat": 34.26858},
      {"id": "610104135003", "name": "å›½æ§", "age": "183", "address": "è¥¿å®‰å¸‚è²æ¹–åŒºåŒ—é™¢é—¨è¡—é“å®‰å®šç¤¾åŒº", "lng": 108.926324, "lat": 34.26858}
      // æ›´å¤šæ•°æ®...
    ];

    // ===================== ç»Ÿè®¡æ ‘ç§æ•°æ® =====================
    const speciesCount = {};
    XA_GUSHU.forEach(tree => {
      const species = tree.name || "æœªæ³¨æ˜";
      speciesCount[species] = (speciesCount[species] || 0) + 1;
    });

    // ===================== åˆ›å»ºæ ‘ç§ç»Ÿè®¡å›¾ï¼ˆChart.jsï¼‰ =====================
    const speciesEntries = Object.entries(speciesCount).sort((a, b) => b[1] - a[1]);
    const topN = 8;
    const labels = [];
    const data = [];
    let others = 0;

    speciesEntries.forEach((item, idx) => {
      if (idx < topN) {
        labels.push(item[0]);
        data.push(item[1]);
      } else {
        others += item[1];
      }
    });
    if (others > 0) {
      labels.push("å…¶å®ƒæ ‘ç§");
      data.push(others);
    }

    const ctx = document.getElementById("speciesChart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "å¤æ ‘æ•°é‡ï¼ˆæ ªï¼‰",
          data: data,
          backgroundColor: labels.map((_, i) => i % 2 === 0 ? '#7aa28f' : '#f0c172'),
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: (context) => `${context.parsed.y} æ ª` } }
        },
        scales: {
          x: { ticks: { font: { size: 11 } } },
          y: {
            beginAtZero: true,
            ticks: { font: { size: 11 } },
            title: { display: true, text: "æ ªæ•°", font: { size: 11 } }
          }
        }
      }
    });

    // ===================== Leaflet åˆå§‹åŒ–åœ°å›¾ =====================
    const map = L.map("map").setView([34.27, 108.95], 11);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // ===================== åœ¨åœ°å›¾ä¸Šæ·»åŠ æ ‘æœ¨æ ‡è®° =====================
    XA_GUSHU.forEach(tree => {
      const pos = [tree.lat, tree.lng];
      const popupHtml = `
        <div>
          <b>${tree.name}</b><br/>
          æ ‘é¾„ï¼š${tree.age}å¹´<br/>
          åœ°å€ï¼š${tree.address}<br/>
        </div>
      `;
      L.marker(pos).addTo(map).bindPopup(popupHtml);
    });
  </script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>è¥¿å®‰å¸‚å¤æ ‘åæœ¨</h1>
      <div>
        <h2>ğŸŒ± æ ‘ç§ç»Ÿè®¡</h2>
        <div class="chart-card">
          <canvas id="speciesChart" height="160" width="300"></canvas>
        </div>
      </div>
    </aside>
    <main id="map"></main>
  </div>
</body>
</html>

