// ===================== 树种统计图（Chart.js） =====================
// 统计树种的数量并按降序排序
const speciesEntries = Object.entries(speciesCount).sort((a, b) => b[1] - a[1]);

const topN = 8; // 显示前8个树种
const labels = [];
const data = [];
let others = 0;
speciesEntries.forEach((item, idx) => {
  if (idx < topN) {
    labels.push(item[0]);
    data.push(item[1]);
  } else {
    others += item[1];
  }
});
if (others > 0) {
  labels.push("其它树种");
  data.push(others);
}

// 获取统计图的上下文
const ctx = document.getElementById("speciesChart").getContext("2d");

// 配色方案
const morandiColors = [
  "#b6543f", // C20 M60 Y60 K5
  "#f3e9dd", // C10 M10 Y15 K0
  "#c27d7d", // C20 M35 Y25 K0
  "#f0d188", // C15 M20 Y60 K0
  "#6c2b33", // C40 M60 Y50 K40
  "#6b7c46", // C50 M20 Y55 K5
  "#a37f3e"  // C60 M25 Y70 K10
];

// 绘制柱状图
new Chart(ctx, {
  type: "bar",
  data: {
    labels: labels,
    datasets: [{
      label: "古树数量（株）",
      data: data,
      backgroundColor: labels.map((_, i) => morandiColors[i % morandiColors.length]),
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false, // 保持图表的响应式布局
    plugins: {
      legend: { display: false }, // 不显示图例
      tooltip: {
        callbacks: {
          label: function(context) {
            return `${context.parsed.y} 株`; // 显示每个柱子的数量
          }
        }
      }
    },
    scales: {
      x: {
        ticks: {
          font: { size: 10 } // X轴标签字体变小
        },
        title: {
          display: true,
          text: "树种",
          font: { size: 12 }
        }
      },
      y: {
        beginAtZero: true,
        ticks: {
          font: { size: 10 } // Y轴标签字体变小
        },
        title: {
          display: true,
          text: "株数",
          font: { size: 12 }
        },
        grid: { color: "#eee" }
      }
    }
  }
});

